项目问题：

1.实现幂等性常见的方式有：悲观锁（ for update ）、乐观锁、唯一约束
2.几种方式，按照最优排序：乐观锁 > 唯一约束 > 悲观锁
摘抄自网络，我面试时候也是这么回答的

### 1.重复支付问题

产生原因：一个支付请求未处理完成之前，又发起了支付请求，发生了两次支付。

解决：1.前端防重 2.后端做幂等性处理。

下面的伪代码会有问题，比如两个请求同时到达第2步，就会发生两次重复支付：

![image-20220914231155193](/Users/iamfenges/Library/Application Support/typora-user-images/image-20220914231155193.png)

加锁优化：

![image-20220914231530435](/Users/iamfenges/Library/Application Support/typora-user-images/image-20220914231530435.png)

![image-20220914231815093](/Users/iamfenges/Library/Application Support/typora-user-images/image-20220914231815093.png)



### 2.超时退库存、优惠券

问题：1.回滚失败如何解决 2. 重复回滚如何预防



理论问题：

### 关于一致性：

- ACID中的一致性
- 一致性哈希
- CAP定理的一致性
- 分布式多副本一致性

**CAP**的一致性是指线性一致性，主要描述了在故障和延时下的副本之前的协同问题

**一致性哈希**是为了解决分布式缓存问题

**分布式多副本一致性**则是保持分布式系统中各个节点之间的数据一致



强一致性：



顺序一致性：



最终一致性： 12306



