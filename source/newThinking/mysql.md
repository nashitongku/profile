mysql锁：

通过索引进行delete、update的，都会给索引和主键加锁。通过非索引进行delete、update的，会给所有行记录加锁。

例子：

唯一索引uq_key的delete操作：根据唯一索引找到记录，给唯一索引加X锁，为了防止并发的sql通过主键修改uq_key的值，还需要同时给主键加X锁.

RR模式下非唯一索引需要加间隙锁



删除缓存有两种方式：

1. 先删除缓存，再更新数据库。解决方案是使用延迟双删。
2. 先更新数据库，再删除缓存。解决方案是消息队列或者其他binlog同步，引入消息队列会带来更多的问题，并不推荐直接使用。



