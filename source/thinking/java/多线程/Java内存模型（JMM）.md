java内存模型是规范：规范、可见性、重排序、原子性

可见性、重排序



为什么会有可见性问题？

因为cpu的多级缓存，导致读的数据过期。

如果公用一个缓存就不会有可见性问题。

为什么要有缓存？

缓存的容量虽小，但速度仅次于cpu





JMM

主内存与本地内存的关系

1.所有变量都存储在主内存中，同时线程也有自己的独立工作内存（主内存变量的拷贝）

2.线程不能直接读写主内存的变量，只能操作自己工作内存的变量，再同步到主内存中

3.主内存线程间共享；工作内存线程独有。线程间通信通过主内存。





Happens-before规则：解决可见性





Volatile: 不适用于a++这种情况，只适合赋值（因为读后再写不是原子操作）

创建对象过程： 1.创建控对象 2.调用构造方法 3.分配给变量